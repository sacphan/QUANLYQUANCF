 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
 <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<div class="page-title-box">
        <div class="row align-items-center">
            <div class="col-sm-6">
                <h2 class="page-title">PurchaseOrder</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item active">Welcome to Dashboard</li>
                </ol>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <div class="card">
                <div class="card-body">
            <div class="row" style="margin-bottom:20px;">
                    <div class="col-sm-12 col-md-1">
                        <div class="dataTables_length" id="example_length">
                            <select name="example_length" aria-controls="example" class="form-control form-control-sm" id="Top">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-3">
                        <div class="input-group ">
                            <input type="text" class="form-control" placeholder="Mã nhập hàng" name="Keyword" id="Keyword">
                            <div class="input-group-append ">
                                <button id="SearchKeyword" type="button" class="btn waves-effect waves-light btn-primary" data-toggle="tooltip" title="Tìm kiếm mã nhập hàng">
                                    <span class="fas fa-search"></span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-2">
                        <select class="select form-control" data-select2-id="1" tabindex="-1" aria-hidden="true" id="Status">
                            <option value="0">All</option>
                            {{#each purchaseorderstatustable}}
                            <option value={{Id}}>{{Name}}</option>
                           
                            {{/each}}
                        </select>
                    </div>

               

                    <div class="col-sm-12 col-md-2">
                        <button id="SearchDate" type="button" class="btn waves-effect waves-light btn-rounded btn-primary" data-toggle="tooltip" title="Tìm kiếm">Tìm kiếm <span class="fas fa-search"></span></button>
                    </div>
                    <div class="col-sm-12 col-md-2">
                        
                    </div>
                    <div class="col-sm-12 col-md-2">
                        <button id="addAgency" class="btn float-right btn-success" data-toggle="modal" data-target="#add-contact" title="Thêm mới"><i class="mdi mdi-plus-circle"></i> Thêm mới</button>
                    </div>
                    <!-- Add Contact Popup Model -->
                   
                </div>
                <div class="row">
 <div class="input-daterange input-group col-md-12" id="date-range">
                       
                        <input type="text" class="form-control  " name="start" id="StartDate" value="" placeholder="MM/DD/YYYY">
                        <div class="input-group-append">
                            <span class="input-group-text bg-info b-0 text-white ">TO</span>
                        </div>
                        <input type="text" class="form-control " name="end" id="EndDate" value="" placeholder="MM/DD/YYYY">
                        </div>
                    
</div>
</br>
            <table id="myTable" class="display nowrap table table-hover table-striped table-bordered" cellspacing="0">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Mã nhập hàng</th>
                        <th>Thời gian</th>
                        <th>Nhà cung cấp</th>
                        <th>Trạng thái</th>
                        <th>Tổng tiền</th>
                        <th>Giảm giá</th>
                        <th>Số tiền nhận từ khách</th>
                        
                    </tr>
                </thead>
                <tbody> 
                    {{#each PurchaseOrder}}                 
                            <tr class="tr-list-agency">
                                <td style="display:none" class="Id">{{Id}}</td>
                                <td>{{@index}}</td>
                                <td class="code">{{Code}}</td>
                                <td class="createdate">{{CreateDate}}</td>
                                <td class="supplier" data-idsupplier="{{Supplier.Id}}">{{Supplier.Name}}</td> 
                                <td class="status" data-idpurchaseorderstatus="{{purchaseorderstatus.Id}}">{{purchaseorderstatus.Name}}</td> 
                                <td class="totalprice">{{TotalPrince}}</td>
                                <td class="discount" >{{Discount}}</td> 
                                <td class="givenpricesupplier" >{{GivenPriceSupplier}}</td>                                  
                                <td class="modal-footer">
                                    <button  class="Edit btn waves-effect waves-light btn-outline-success" type="button" data-toggle="modal" data-target="#add-contact" data-placement="top" data-original-title="Edit"><i class="fa fa-edit"></i></button>
                                    <button  class="Delete btn waves-effect waves-light btn-outline-danger" type="button" data-toggle="tooltip" data-placement="top" data-original-title="Delete" aria-describedby="tooltip67802"><i class="fa fa-trash"></i></button>                                                    
                                </td>
                            </tr>
                       {{/each}}
                </tbody>
            </table>
            </div>
            </div>
        </div>
    </div>
      
      <link rel="stylesheet" href="https://jqueryvalidation.org/files/demo/site-demos.css">
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>

<div id="add-contact" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <form id="formAgency" class="form-horizontal">
                    <div class="form-group" id="divName">
                        <label class="col-md-12">Mã nhập hàng</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" id="code" name="code" placeholder="Mã nhập hàng" required maxlength="100" />                          
                        </div>
                    </div>                  
                    <div class="form-group" >
                        <label class="col-md-12">Nhà cung cấp</label>
                        <div class="col-md-12">
                            <select class="form-control custom-select" id="supplier" name="supplier" required>
                                     
                                        {{#each supplierAll}}
                                        <option value="{{Id}}">{{Name}}</option>
                                        {{/each}}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" >
                        <label class="col-md-12">Trạng thái</label>
                        <div class="col-md-12">
                            <select class="form-control custom-select" id="status" name="status" required>
                            {{#each purchaseorderstatustable}}
                            <option value={{Id}}>{{Name}}</option>
                           
                            {{/each}}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" >
                        <label class="col-md-12">Tổng tiền</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" id="totalprice" name="totalprice" placeholder="Mã nhập hàng" required maxlength="100" />                          
                        </div>
                    </div>  
                    <div class="form-group" >
                        <label class="col-md-12">Giảm giá</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" id="discount" name="discount" placeholder="Mã nhập hàng" required maxlength="100" />                          
                        </div>
                    </div>  
                    <div class="form-group" >
                        <label class="col-md-12">Số tiền nhận từ khách</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" id="givenpricesupplier" name="givenpricesupplier" placeholder="Mã nhập hàng" required maxlength="100" />                          
                        </div>
                    </div>  
                   
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info waves-effect" id="btnSave">Save</button>
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cancel</button>
                <input hidden="hidden" type="text" class="form-control" id="Id" placeholder="Id">
                <input hidden="hidden" type="text" class="form-control" id="UserId" placeholder="UserId">
            </div>
        </div>
    </div>
</div>
   
<script>

     $(".Edit").click(function() {
        
        $("#myModalLabel").text("Edit Purchase Order");
        // get the current row
        var currentRow = $(this).closest("tr");      
        var idsupplier = currentRow.find(".supplier").attr("data-idsupplier");
        var status = currentRow.find(".status").attr("data-idpurchaseorderstatus");
       var totalprice = currentRow.find(".totalprice").text();
       var discount = currentRow.find(".discount").text();
       var givenpricesupplier = currentRow.find(".givenpricesupplier").text();
        var code = currentRow.find(".code").text();
        
        var Id=currentRow.find(".Id").text();
        $("#supplier").val(idsupplier);
        $("#status").val(status);
        $("#code").val(code);
        $("#totalprice").val(totalprice);
        $("#discount").val(discount);
        $("#givenpricesupplier").val(givenpricesupplier);
        var required = document.querySelectorAll("input[required]");
        required.forEach(function (element) {
            element.style["border"] = "1px solid #ced4da";
        });
        $("#btnSave").click(function(){
            
            let idsupplier = $("#supplier").val();
            let idstatus = $("#status").val();
            let code = $("#code").val();
             let totalprice = $("#totalprice").val();
            let discount = $("#discount").val();
            let givenpricesupplier = $("#givenpricesupplier").val();
              $.ajax({
                    type: "POST",
                    url: "/Admin/PurchaseOrder/Edit" ,
                    data: {
                        Id:Id,
                        idsupplier: idsupplier,
                        idstatus:idstatus,
                        code:code,
                        totalprice:totalprice,
                        discount:discount,
                        givenpricesupplier:givenpricesupplier
                    },
                    success: function (data) {
                       
                            toastr.success( "Edit sucessfull");
                             location.reload();
                        
                    }
                });
        })
        
    
    });
$(".Delete").click(function(){
     $("#myModalLabel").text("Edit Purchase Order");
        // get the current row
    var currentRow = $(this).closest("tr");  
    var Id=currentRow.find(".Id").text();
  
    swal({
            title: "Bạn có chắc là muốn xóa?",
            text: "Nếu xóa đi dữ liệu sẽ không thể phục hồi",
           
            buttons: true,
            dangerMode: true
        }).then((clickYes) => {
            if (clickYes) {
                $.ajax({
                    type: "POST",
                    url: "/Admin/PurchaseOrder/Delete",
                    data: {
                        Id: Id
                    },
                    success: function (data) {
                       toastr.success( "Edit sucessfull");
                             location.reload();
                    }
                });
            }
        });
})
   $("#addAgency").click(function(){
       $("#supplier").val("");
        $("#status").val("");
        $("#code").val("");
  $("#totalprice").val("");
        $("#discount").val("");
        $("#givenpricesupplier").val("");
          $("#myModalLabel").text("Add Purchase Order");
        // get the current row
      
        $("#btnSave").click(function(){
              let totalprice = $("#totalprice").val();
            let discount = $("#discount").val();
            let givenpricesupplier = $("#givenpricesupplier").val();
            let idsupplier = $("#supplier").val();
            let idstatus = $("#status").val();
            let code = $("#code").val();
              $.ajax({
                    type: "POST",
                    url: "/Admin/PurchaseOrder/Add" ,
                    data: {
                       
                        idsupplier: idsupplier,
                        idstatus:idstatus,
                        code:code,
                         totalprice:totalprice,
                        discount:discount,
                        givenpricesupplier:givenpricesupplier
                    },
                    success: function (data) {
                       
                            toastr.success( "Edit sucessfull");
                             location.reload();
                        
                    }
                });
        })
   })

    $(function () {
         
       
        $('[data-toggle="tooltip"]').tooltip();
        $('[data-toggle="modal"]').tooltip()
    })

</script>
